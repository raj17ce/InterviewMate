<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>InterviewMate | AI-Powered Interview Practice</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root {
            --primary: #4361ee;
            --primary-light: #4895ef;
            --primary-dark: #3a0ca3;
            --success: #4cc9f0;
            --warning: #f72585;
            --text-primary: #2b2d42;
            --text-secondary: #8d99ae;
            --bg-light: #f8f9fa;
            --bg-white: #ffffff;
            --shadow-sm: 0 2px 8px rgba(0,0,0,0.05);
            --shadow-md: 0 4px 12px rgba(0,0,0,0.08);
            --radius-sm: 8px;
            --radius-md: 12px;
            --radius-lg: 20px;
            --transition: all 0.3s ease;
            --font-main: 'Segoe UI', system-ui, -apple-system, sans-serif;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: var(--font-main);
            background: var(--bg-light);
            color: var(--text-primary);
            line-height: 1.6;
            min-height: 100vh;
            padding: 0;
            margin: 0;
        }

        .app-container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        .app-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 20px 0;
            border-bottom: 1px solid rgba(0,0,0,0.05);
            margin-bottom: 30px;
        }

        .app-logo {
            display: flex;
            align-items: center;
            gap: 12px;
            font-size: 24px;
            font-weight: 700;
            color: var(--primary);
        }

        .app-logo i {
            font-size: 28px;
        }

        .app-main {
            display: grid;
            grid-template-columns: 1fr;
            gap: 30px;
        }

        @media (min-width: 992px) {
            .app-main {
                grid-template-columns: 3fr 2fr;
            }
        }

        .card {
            background: var(--bg-white);
            border-radius: var(--radius-md);
            box-shadow: var(--shadow-sm);
            padding: 24px;
            transition: var(--transition);
        }

        .card:hover {
            box-shadow: var(--shadow-md);
        }

        .card-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .card-title {
            font-size: 18px;
            font-weight: 600;
            color: var(--text-primary);
        }

        .video-container {
            position: relative;
            border-radius: var(--radius-sm);
            overflow: hidden;
            background: #000;
            aspect-ratio: 16/9;
        }

        #videoElement {
            width: 100%;
            height: 100%;
            object-fit: cover;
            border-radius: var(--radius-sm);
        }

        .video-controls {
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            background: rgba(0,0,0,0.5);
            padding: 12px;
            display: flex;
            justify-content: center;
            gap: 16px;
            opacity: 0;
            transition: opacity 0.3s ease;
        }

        .video-container:hover .video-controls {
            opacity: 1;
        }

        .video-status {
            position: absolute;
            top: 16px;
            right: 16px;
            background: rgba(0,0,0,0.6);
            color: white;
            padding: 6px 12px;
            border-radius: 20px;
            font-size: 14px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .status-indicator {
            width: 10px;
            height: 10px;
            border-radius: 50%;
            background: #ccc;
        }

        .status-indicator.recording {
            background: #f72585;
            animation: pulse 1.5s infinite;
        }

        @keyframes pulse {
            0% { opacity: 1; }
            50% { opacity: 0.5; }
            100% { opacity: 1; }
        }

        .btn {
            padding: 12px 24px;
            border-radius: var(--radius-sm);
            border: none;
            font-weight: 600;
            font-size: 16px;
            cursor: pointer;
            transition: var(--transition);
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }

        .btn-primary {
            background: var(--primary);
            color: white;
        }

        .btn-primary:hover {
            background: var(--primary-dark);
            transform: translateY(-2px);
        }

        .btn-outline {
            background: transparent;
            color: var(--primary);
            border: 2px solid var(--primary);
        }

        .btn-outline:hover {
            background: var(--primary);
            color: white;
        }

        .btn-icon {
            width: 48px;
            height: 48px;
            padding: 0;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .transcript-container {
            height: 100%;
            display: flex;
            flex-direction: column;
        }

        .transcript-content {
            flex-grow: 1;
            background: var(--bg-white);
            border-radius: var(--radius-sm);
            padding: 20px;
            margin-bottom: 20px;
            min-height: 200px;
            max-height: 400px;
            overflow-y: auto;
            border: 1px solid rgba(0,0,0,0.1);
        }

        .transcript-actions {
            display: flex;
            gap: 12px;
        }

        .recognition-status {
            display: flex;
            align-items: center;
            gap: 8px;
            margin-top: 16px;
            color: var(--text-secondary);
            font-size: 14px;
        }

        .tooltip {
            position: relative;
            display: inline-block;
        }

        .tooltip .tooltip-text {
            visibility: hidden;
            width: 120px;
            background-color: rgba(0,0,0,0.8);
            color: #fff;
            text-align: center;
            border-radius: 6px;
            padding: 5px;
            position: absolute;
            z-index: 1;
            bottom: 125%;
            left: 50%;
            transform: translateX(-50%);
            opacity: 0;
            transition: opacity 0.3s;
            font-size: 14px;
        }

        .tooltip:hover .tooltip-text {
            visibility: visible;
            opacity: 1;
        }

        @media (max-width: 768px) {
            .app-header {
                flex-direction: column;
                align-items: flex-start;
                gap: 12px;
            }
            
            .btn {
                padding: 10px 16px;
                font-size: 14px;
            }
            
            .card {
                padding: 16px;
            }
        }
    </style>
</head>
<body>
    <div class="app-container">
        <header class="app-header">
            <div class="app-logo">
                <i class="fas fa-video"></i>
                <span>InterviewMate</span>
            </div>
            <div class="app-actions">
                <button class="btn btn-outline" id="helpButton">
                    <i class="fas fa-question-circle"></i>
                    Help
                </button>
            </div>
        </header>

        <main class="app-main">
            <section class="card">
                <div class="card-header">
                    <h2 class="card-title">Interview Session</h2>
                    <div class="tooltip">
                        <i class="fas fa-info-circle"></i>
                        <span class="tooltip-text">Position yourself in frame and click Start to begin</span>
                    </div>
                </div>
                
                <div class="video-container">
                    <video autoplay id="videoElement"></video>
                    <div class="video-status">
                        <span class="status-indicator" id="recordingIndicator"></span>
                        <span id="statusText">Ready</span>
                    </div>
                </div>
                
                <div style="margin-top: 20px; display: flex; gap: 12px; justify-content: center;">
                    <button class="btn btn-primary" id="startButton">
                        <i class="fas fa-microphone"></i>
                        Start Recording
                    </button>
                    <button class="btn btn-outline" id="nextButton">
                        <i class="fas fa-forward"></i>
                        Next Question
                    </button>
                </div>
            </section>

            <section class="card transcript-container">
                <div class="card-header">
                    <h2 class="card-title">Your Response</h2>
                    <div class="tooltip">
                        <i class="fas fa-info-circle"></i>
                        <span class="tooltip-text">Your speech will be transcribed here</span>
                    </div>
                </div>
                
                <div class="transcript-content" id="transcript">
                    Your transcribed response will appear here after you start speaking...
                </div>
                
                <div class="transcript-actions">
                    <button class="btn btn-primary" id="submitButton">
                        <i class="fas fa-paper-plane"></i>
                        Submit
                    </button>
                    <button class="btn btn-outline" id="copyButton">
                        <i class="fas fa-copy"></i>
                        Copy
                    </button>
                    <button class="btn btn-outline" id="saveButton">
                        <i class="fas fa-save"></i>
                        Save
                    </button>
                </div>
                
                <div class="recognition-status">
                    <i class="fas fa-info-circle"></i>
                    <span id="recognitionStatus">Ready to record</span>
                </div>
            </section>
        </main>
    </div>

    <script>
        // Access the webcam
        const video = document.getElementById('videoElement');
        const startButton = document.getElementById('startButton');
        const nextButton = document.getElementById('nextButton');
        const transcriptOutput = document.getElementById('transcript');
        const statusText = document.getElementById('statusText');
        const recordingIndicator = document.getElementById('recordingIndicator');
        const recognitionStatus = document.getElementById('recognitionStatus');
        const copyButton = document.getElementById('copyButton');
        const saveButton = document.getElementById('saveButton');
        const submitButton = document.getElementById('submitButton');
        const helpButton = document.getElementById('helpButton');

        // Initialize webcam
        if (navigator.mediaDevices.getUserMedia) {
            navigator.mediaDevices.getUserMedia({ video: true })
            .then((stream) => {
                video.srcObject = stream;
            })
            .catch((error) => {
                console.error("Error accessing webcam: ", error);
                transcriptOutput.textContent = "⚠️ Error accessing webcam. Please check your camera permissions.";
            });
        } else {
            alert("Your browser does not support accessing the webcam.");
        }

        // Speech recognition setup
        const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
        const recognition = new SpeechRecognition();
        recognition.continuous = true;
        recognition.interimResults = false;

        let fullTranscript = '';
        let isListening = false;

        // Handle the Start button
        startButton.addEventListener('click', () => {
            if (!isListening) {
                fullTranscript = '';
                transcriptOutput.textContent = 'Listening to your response...';
                transcriptOutput.style.color = '#666';
                recognition.start();
                isListening = true;
                
                // Update UI
                startButton.innerHTML = '<i class="fas fa-stop"></i> Stop Recording';
                startButton.classList.remove('btn-primary');
                startButton.classList.add('btn-outline');
                statusText.textContent = "Recording";
                recordingIndicator.classList.add('recording');
                recognitionStatus.textContent = "Speech recognition active";
            } else {
                recognition.stop();
                isListening = false;
                
                // Update UI
                startButton.innerHTML = '<i class="fas fa-microphone"></i> Start Recording';
                startButton.classList.remove('btn-outline');
                startButton.classList.add('btn-primary');
                statusText.textContent = "Paused";
                recordingIndicator.classList.remove('recording');
                recognitionStatus.textContent = "Speech recognition paused";
            }
        });

        nextButton.addEventListener('click', () => {
            if (isListening) {
                recognition.stop();
                isListening = false;
                
                // Update UI
                startButton.innerHTML = '<i class="fas fa-microphone"></i> Start Recording';
                startButton.classList.remove('btn-outline');
                startButton.classList.add('btn-primary');
                statusText.textContent = "Ready";
                recordingIndicator.classList.remove('recording');
                recognitionStatus.textContent = "Ready for next question";
            }
        });

        recognition.onresult = (event) => {
            const currentTranscript = event.results[event.results.length - 1][0].transcript;
            fullTranscript += currentTranscript + ' ';
            
            // Update the transcript in real-time
            transcriptOutput.textContent = fullTranscript.trim();
            transcriptOutput.style.color = 'var(--text-primary)';
            
            console.log("Transcribing:", currentTranscript);
        };

        recognition.onend = () => {
            if (!isListening) {
                if (fullTranscript.trim()) {
                    // Final transcript is already displayed in real-time
                    recognitionStatus.textContent = "Recording stopped";
                } else {
                    transcriptOutput.textContent = "No speech detected. Try again by clicking Start Recording.";
                    transcriptOutput.style.color = 'var(--warning)';
                    recognitionStatus.textContent = "No speech detected";
                }
            } else {
                // If it ended unexpectedly but we're still supposed to be listening
                recognition.start();
            }
        };

        recognition.onerror = (event) => {
            console.error("Speech recognition error: ", event.error);
            recognitionStatus.textContent = `Error: ${event.error}. Try again.`;
            isListening = false;
            startButton.innerHTML = '<i class="fas fa-microphone"></i> Start Recording';
            startButton.classList.remove('btn-outline');
            startButton.classList.add('btn-primary');
            statusText.textContent = "Error";
            recordingIndicator.classList.remove('recording');
        };

        // Copy button functionality
        copyButton.addEventListener('click', () => {
            if (fullTranscript.trim()) {
                navigator.clipboard.writeText(fullTranscript.trim())
                    .then(() => {
                        const originalText = copyButton.innerHTML;
                        copyButton.innerHTML = '<i class="fas fa-check"></i> Copied!';
                        setTimeout(() => {
                            copyButton.innerHTML = originalText;
                        }, 2000);
                    })
                    .catch(err => {
                        console.error('Failed to copy: ', err);
                    });
            }
        });

        // Save button functionality
        saveButton.addEventListener('click', () => {
            if (fullTranscript.trim()) {
                const blob = new Blob([fullTranscript.trim()], { type: 'text/plain' });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = 'interview-response.txt';
                document.body.appendChild(a);
                a.click();
                document.body.removeChild(a);
                URL.revokeObjectURL(url);
                
                const originalText = saveButton.innerHTML;
                saveButton.innerHTML = '<i class="fas fa-check"></i> Saved!';
                setTimeout(() => {
                    saveButton.innerHTML = originalText;
                }, 2000);
            }
        });

        // Submit button functionality - send transcript to backend
        submitButton.addEventListener('click', async () => {
            if (fullTranscript.trim()) {
                try {
                    // Show loading state
                    const originalText = submitButton.innerHTML;
                    submitButton.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Submitting...';
                    submitButton.disabled = true;
                    
                    // Prepare data to send
                    const data = {
                        transcript: fullTranscript.trim(),
                        timestamp: new Date().toISOString(),
                        // Add any other data you want to send
                    };
                    
                    // Send POST request to backend
                    const response = await fetch('https://your-backend-api.com/transcripts', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                        },
                        body: JSON.stringify(data)
                    });
                    
                    if (response.ok) {
                        // Success
                        submitButton.innerHTML = '<i class="fas fa-check"></i> Submitted!';
                        recognitionStatus.textContent = "Transcript submitted successfully";
                        
                        // Optional: Clear transcript after successful submission
                        // fullTranscript = '';
                        // transcriptOutput.textContent = 'Transcript submitted successfully. Ready for next response.';
                    } else {
                        // Handle error
                        throw new Error('Server responded with status: ' + response.status);
                    }
                } catch (error) {
                    console.error('Error submitting transcript:', error);
                    submitButton.innerHTML = '<i class="fas fa-exclamation-triangle"></i> Failed';
                    recognitionStatus.textContent = "Error submitting transcript. Please try again.";
                } finally {
                    // Reset button after some time
                    setTimeout(() => {
                        submitButton.innerHTML = '<i class="fas fa-paper-plane"></i> Submit';
                        submitButton.disabled = false;
                    }, 3000);
                }
            } else {
                recognitionStatus.textContent = "Nothing to submit. Please record your response first.";
            }
        });

        // Help button functionality
        helpButton.addEventListener('click', () => {
            alert("InterviewMate Instructions:\n\n1. Position yourself in the camera frame\n2. Click 'Start Recording' to begin speech recognition\n3. Speak clearly to answer the interview question\n4. Click 'Stop Recording' to pause or 'Next Question' to finish\n5. Your transcribed response will appear in the right panel\n6. Use the Copy or Save buttons to keep your response");
        });
    </script>
</body>
</html>